\section[Nakajima operators for Hilbert schemes of points on surfaces]{Nakajima operators for Hilbert schemes of points on surfaces%
\sectionmark{Nakajima operators}}
\sectionmark{Nakajima operators}
\label{Section_Hilbert}
Let $A$ be a smooth projective complex surface. 
%Set $H\defIs H^*(A,\Q)$. 
Let $A\hilb{n}$ the Hilbert scheme of $n$ points on the surface, \ie the moduli space of finite subschemes of $A$ of length $n$.
%$$\Hilb^ n : S \mapsto \left\{ Z\subset S\times A\,|\,Z\text{ closed subscheme, } p_1 : Z\rightarrow S \text{ flat and finite of degree }n\right\}.$$
$A\hilb{n}$ is again smooth and projective of dimension $2n$, cf.~\cite{Fogarty}. 
Their rational cohomology can be described in terms of Nakajima's~\cite{Nakajima} operators. First consider the direct sum
$$
\H \defIs  \bigoplus_{n=0}^{\infty} H^*(A\hilb{n},\Q).
$$
This space is bigraded by cohomological \emph{degree} and the \emph{weight}, which is given by the number of points $n$. The unit element in $H^0(A\hilb{0},\Q) \cong \Q$ is denoted by $\vac$, called the \emph{vacuum}.
\begin{defipro}
There are linear operators $\q_m(a)$, for each $m\geq 1$ and $a \in H^*(A,\Q)$, acting on $\H,$ which have the following properties: They depend linearly on $a$, and if $a\in H^k(A,\Q)$ is homogeneous, the operator $\q_{m}(a)$ is bihomogeneous of degree $k+2(m-1)$ and weight $m$:
$$
\q_{m}(a) : H^l(A\hilb{n}) \rightarrow H^{l+k+2(m-1)}(A\hilb{n+m})
$$
To construct them, first define incidence varieties $\mathcal Z_m\subset A\hilb{n}\times A\times A\hilb{n+m}$ by
$$
\mathcal Z_m \defIs  \left\{(\xi,x,\xi')\, |\, \xi\subset\xi',\, \supp(\xi') -\supp(\xi) = mx \right\}.
$$
Then $\q_m(a)(\beta) $ is defined as the Poincar\'e dual of 
$$
\pr_{3*}\left( \left(\pr_2^*(\alpha)\cdot \pr_3^*(\beta)\right) \cap [\mathcal Z_m] \right).
$$
\end{defipro}
Consider now the superalgebra generated by the $\q_m(a)$. 
Every element in $\H$ can be decomposed uniquely as a linear combination of products of operators $\q_{m}(a)$, acting on the vacuum. 
In other words, the $\q_m(a)$ generate $\H$ and there are no algebraic relations between them (except the linearity in $a$ and the super-commutativity).
\begin{example}
The unit $1_{A\hilb{n}} \in H^0({A\hilb{n}},\Q)$ is given by $\frac{1}{n!}\q_1(1)^n\vac$. The sum of all $1_{A\hilb{n}}$ in the formal completion of $\H$ is sometimes denoted by
$
\left|1\right> \defIs  \exp(\q_1(1))\vac.
$
\end{example}

\begin{definition}
To give the cup product structure of $\H$, define operators $\G(a)$ for $a \in H^*(A)$. Let $\Xi_n \subset A\hilb{n}\times A$ be the universal subscheme. Then the action of $\G(a)$ on $H^*(A\hilb{n})$ is multiplication with the class
$$
\pr_{1*}\left( \ch(\mathcal{O}_{\Xi_n})\cdot \pr_2^*(\td(A)\cdot a) \right) \in H^*(A\hilb{n}).
$$
For $a \in H^k(A)$, we define $\G_i(a)$ as the component of $\G(a)$ of cohomological degree $k+2i$. A differential operator $\mathfrak{d}$ is given by $\G_1(1)$. It means multiplication with the first Chern class of the tautological sheaf $\pr_{1*}\left( \mathcal{O}_{\Xi_n}\right)$.
\end{definition}
\begin{notation} 
We abbreviate $\q \defIs  \q_1(1)$ and for its derivative $\q'\defIs  [\mathfrak d, \q]$. For any operator $X$ we write $X^{(k)}$ for the $k$-fold derivative: $X^{(k)} \defIs \ad^k(\d) (X)$.
\end{notation}
In~\cite{LehnSorger} and~\cite{LiQinWang} we find various commutation relations between these operators, that allow to determine all multiplications in the cohomology of the Hilbert scheme. First of all, if $X$ and $Y$ are operators of degree $d$ and $d'$, their commutator is defined in the super sense: 
$$
[X,Y] \defIs  XY - (-1)^{dd'}YX.
$$
The integral on $A\hilb{n}$ induces a non-degenerate bilinar form on $\H$: for classes $\alpha,\,\beta\in H^*(A\hilb{n})$ it is given by
$$
(\alpha,\beta)_{A\hilb{n}} \defIs   \int_{A\hilb{n}}\alpha\cdot\beta.
$$
If $X$ is a homogeneous linear operator of degree $d$ and weight $m$, acting on $\H$, define its adjont $X^\dagger$ by
$$
(X(\alpha),\beta)_{A\hilb{n+m}}  = (-1)^{d|\alpha|}( \alpha , X^\dagger (\beta))_{A\hilb{n}}.
$$
We put $\q_0(a) \defIs 0$ and for $m<0$, $\q_m(a) \defIs  (-1)^m \q_{-m}(a)^\dagger$. Note that, for all $m\in\Z$, the bidegree of $\q_m(a)$ is $(m,|a| + 2(|m|-1))$. If $m$ is positive, $\q_m$ is called a creation operator, otherwise it is called annihiliation operator. Now define
$$
\mathfrak{L}_m(a) \defIs  \left\{ 
\begin{array}{ll}
 \tfrac{1}{2}\sum\limits_{k\in\Z}\sum\limits_{i}\q_k( a_{(1)})\q_{m-k}( a_{(2)}), & \text{ if } m\neq 0, \vspace{4mm}\\
 \sum\limits_{k>0}\sum\limits_{i}\q_k( a_{(1)})\q_{-k}( a_{(2)}), & \text{ if } m= 0. \\
\end{array}
\right.
$$
where $\sum_i a_{(1)}\otimes  a_{(2)}$ is the push-forward of $a$ along the diagonal $\tau_2 :A \rightarrow A\times A$ (in Sweedler notation).
\begin{remark}
This can be expressed more elegantly using normal ordering: the operator $\nor\q_m\q_n\mal(a\otimes b)$ is defined in a way such that the annihilation operator act first. Then we may write $\mathfrak{L}_m(a) = \sum_k
\nor \q_k \q_{m-k} \mal (\tau_{2*}(a))$.
\end{remark}
\begin{remark}
In a similar manner as above, we can use the integral over $A$ to define a bilinear form on $H^*(A,\Q)$. The adjoint of the multiplication map gives a coassiocative comultiplication
$$
\Delta : H^*(A,\Q) \longrightarrow H^*(A,\Q)\otimes H^*(A,\Q)
$$
that corresponds to $\tau_{2*}$. The sign convention in~\cite{LehnSorger} is such that $-\Delta =  \tau_{2*}$. We denote by $\Delta^k$ the $k$-fold composition of $\Delta$.
\end{remark}
\begin{lemma}\cite[Thm.~2.16]{LiQinWang} Denote $K_A\in H^2(A,\Q)$ the class of the canonical divisor. We have:
\label{commutators}
\begin{align}
[\q_m(a), \q_n(b)] &= m\cdot \delta_{m+n} \cdot \int_A ab \\
\label{qLcommute}
[\mathfrak{L}_m(a),\q_n(b)] &= -n\cdot \q_{m+n}(ab) \\
\label{DiffNaka}
[\mathfrak{d},\q_m(a)] &= m \cdot \mathfrak{L}_m(a) + \tfrac{m(|m|-1)}{2} \q_m(K_A a) \\
[\mathfrak{L}_m(a),\mathfrak{L}_n(b)] &= (m-n) \mathfrak{L}_{m+n}(ab) - \frac{m^3-m}{12} \delta_{m+n}\int_A abe \\
[\G(a),\q_1(b)] &= \exp(\ad(\mathfrak{d}))(\q_1(a b) ) \\
[\G_k(a),\q_1(b)] &= \tfrac{1}{k!} \ad(\mathfrak{d})^k(\q_1(a b) ) 
\end{align}
\end{lemma}
\begin{remark}\label{HRep}
Note (cf.~\cite[Thm.~3.8]{LehnSorger}) that (\ref{qLcommute}) together with (\ref{DiffNaka}) imply that 
\begin{equation}\label{NakaDel}
\q_{m+1}(a) = \tfrac{(-1)^m}{m!}(\ad\q')^m\left(\q_1(a)\right),
\end{equation}
so there are two ways of writing an element of $\H$: As a linear combination of products of creation operators $\q_m(a)$ or as a linear combination of products of the operators $\mathfrak{d}$ and $\q_1(a)$. This second representation is more suitable for computing cup-products, but not faithful. 
Equations (\ref{DiffNaka}) and (\ref{NakaDel}) permit now to switch between the two representations, using that
\begin{gather}
\mathfrak{d} \vac = 0 ,  \\
\mathfrak{L}_m(a) \vac = \left\{ 
\begin{array}{cl}
 \tfrac{1}{2}\sum\limits_{k=1}^{m-1}\sum\limits_{i}\q_k(a_{(1)})\q_{m-k}(a_{(2)})\vac, & \text{ if } m>1, \vspace{4mm}\\
 0, & \text{ if } m\leq 1. \\
\end{array}
\right.\\
\end{gather}
\end{remark}
Next we give some formulas involving higher derivatives of Nakajima operators that can be of use in formal computations.
\begin{proposition}
Suppose $K_Aa=0$. 
Denote $\mathbf e\defIs -\chi(A)x$ the Euler class of $A$.
Note that if $A$ is a torus, $\mathbf e=0$. 
For all $k,m$, the following formulas hold:
\begin{align}
\label{adq}
\ad \q  \frac{\q_m^{(k+1)}(a)}{m^{k+1}} & = (k+1)  \frac{\q_{m+1}^{(k)}(a)}{(m+1)^{k}} + \frac{k^3-k}{24}\frac{\q_{m+1}^{(k-2)}(a\mathbf e)}{(m+1)^{k-2}} , \\
\label{adq'}
\ad \q' \frac{\q_m^{(k)}(a)}{m^k} & = (k-m) \frac{\q_{m+1}^{(k)}(a)}{(m+1)^k}+ \frac{k(k-1)(k-3m-2)}{24}\frac{\q_{m+1}^{(k-2)}(a\mathbf e)}{(m+1)^{k-2}} .
\end{align}
%For all $s,t,k\geq 0$ the following formula holds:
\end{proposition}
\begin{proof}
Let us start with (\ref{adq}). This is a consequence of Theorem 4.2 of~\cite{LiQinWang2} which states that 
\begin{align*}
\frac{\q_m^{(k)}(a)}{m^k}
& = \frac{1}{k+1}\sum_{i_0+\ldots+i_k=m} \nor \q_{i_0}\cdots \q_{i_k} \mal  (\tau_*(a)) \\
& +  k \sum_{j_0+\ldots+j_{k-2}=m} \frac{j_0^2+\ldots+j_{k-2}^2-1}{24}\nor \q_{j_0}\cdots \q_{j_{k-2}} \mal  (\tau_*(a\mathbf e)) .
\end{align*}
Using that 
$[\q,\nor \q_{i_0}\cdots \q_{i_k} \mal  (\Delta^k(a)) ] = \sum_{r=0}^k \delta_{i_r+1} \nor\q_{i_0}\cdots \widehat{\q}_{i_r} \cdots \q_{i_k} \mal (\tau_*(a))$, 
we calculate:
{\allowdisplaybreaks
\begin{align*}
\ad\q \frac{\q_m^{(k+1)}(a)}{m^{k+1}} 
  =\, &\frac{1}{k+2}\sum_{i_0+\ldots+i_{k+1}=m}\!\! \left[\q,\nor \q_{i_0}\cdots \q_{i_{k+1}} \mal (\tau_*(a))\right] \\
 & + (k+1)\!\! \sum_{j_0+\ldots+j_{k-1}=m}\!\! \frac{j_0^2+\ldots+j_{k-1}^2-1}{24}\left[\q,\nor \q_{j_0}\cdots \q_{j_{k-1}} \mal (\tau_*(a\mathbf e)) \right]\\
  =\, & \sum_{i_0+\ldots+i_{k}=m+1} \!\!\nor \q_{i_0}\cdots \q_{i_{k}} \mal  (\tau_*(a)) \\
 & + k(k+1)\!\! \sum_{j_0+\ldots+j_{k-2}=m+1}\!\! \frac{j_0^2+\ldots+j_{k-2}^2}{24}\nor \q_{j_0}\cdots \q_{j_{k-2}} \mal (\tau_*(a\mathbf e)) \\
  =\, & (k+1)  \frac{\q_{m+1}^{(k)}(a)}{(m+1)^{k}} + \frac{k^3-k}{24}\frac{\q_{m+1}^{(k-2)}(a\mathbf e)}{(m+1)^{k-2}}.
\end{align*}
}
Equation (\ref{adq'}) follows from (\ref{adq}) using the Jacobi identity: $\ad \q' = \ad [\mathfrak d,\q] = \ad \mathfrak d  \ad \q - \ad \q\ad \mathfrak d  $.
\end{proof}
\begin{corollary} \label{adqCorollary}
Suppose $K_Aa=0$.
Iterated application of the above proposition gives
 \begin{equation}
 \ad(\q)^s \frac{\q_{m}^{(k+s)}(a)}{m^{k+s}(k+s)!} =\frac{\q_{m+s}^{(k)}(a)}{(m+s)^kk!} + \frac{s}{24}\frac{\q_{m+s}^{(k-2)}(a\mathbf e)}{(m+s)^{k-2}(k-2)!}.
\end{equation}
\end{corollary}
\begin{proposition}


Suppose $K_Aa=0$.
In the formal completion of $\H$ we have:
$$
\left[ \G(a),\exp(\q)\right] =
\exp(\q) \sum_{\substack{s\geq 1\\k\geq 0}}\frac{(-1)^{s-1}}{s!}\left(\frac{\q_s^{(k)}(a)}{s^{k}k!} + \frac{s-1}{24}\frac{\q_s^{(k)}(a\mathbf e)}{s^{k}k!}\right).
$$
%More explicitely, we have for the class $\G_r(a)1$:
%$$
%\G_r(a)\frac{1}{n!}\q^n\vac = 
%\sum_{\substack{s+k=r+1\\s>k}} \frac{(-1)^{s+1}}{k!\, s^k}\frac{1}{s!(n-s)!} \q_1(1)^{n-s} \mathfrak d^k \q_s(a)\vac.
%$$
\end{proposition}
\begin{proof}
Equation (4.6) of~\cite{LehnSorger} evaluates 
\begin{align*}
\left[ \G(a),\exp(\q)\right] &= \exp(\q) \sum_{\substack{s\geq 1\\k\geq 0}} \frac{(-\ad \q)^{s-1}}{s!}\left(\frac{(\ad \mathfrak d)^k}{k!} (\q_1(a)) \right) \\
 &\stackrel{\text{Cor~\ref{adqCorollary}}}{=} \exp(\q)  \sum_{s\geq 1}\frac{(-1)^{s-1}}{s!}\left(\sum_{k\geq s-1}\frac{\q_s^{(k-s+1)}(a)}{s^{k-s+1}(k-s+1)!}
  \right.\\&\hspace{140pt} \left. + \sum_{k\geq s+1}\frac{s-1}{24}\frac{\q_s^{(k-s-1)}(a)}{s^{k-s-1}(k-s-1)!} \right)\\
  &=\exp(\q) \sum_{\substack{s\geq 1\\k\geq 0}}\frac{(-1)^{s-1}}{s!}\left(\frac{\q_s^{(k)}(a)}{s^{k}k!} + \frac{s-1}{24}\frac{\q_s^{(k)}(a\mathbf e)}{s^{k}k!}\right).
\qedhere
\end{align*}
%\begin{gather*}
%\sum_{n,k}\G_k(a)\frac{\q_1(1)^n}{n!}\vac = \G(a)\exp(\q_1(1))\vac \\
%\stackrel{!}{=} \exp(\q_1(1)) \sum_{i,j}(-1)^{i+1} \frac{\mathfrak d^j}{j!}\frac{\q_i(1)}{i!i^j}\vac
%\end{gather*}
\end{proof}
\clearpage
\begin{example} 
\begin{align}
 \G_0(a)\q^n\vac & = n\cdot \q^{n-1}\q_1(a)\vac, \\
 \G_1(a)\q^n\vac & = -\binom{n}{2} \q^{n-2}\q_2(a)\vac, \\
 \G_2(a)\q^n\vac & = \binom{n}{3} \q^{n-3}\q_3(a)\vac - \binom{n}{2} \q^{n-2}\mathfrak{L}_2(a)\vac.
\end{align}
\end{example}

\begin{remark}
We adopted the notation from~\cite{LiQinWang}, which differs from the conventions in~\cite{LehnSorger}. Here is part of a dictionary:
\begin{center}
\begin{tabular}{c|c} 
Notation from~\cite{LiQinWang} & Notation from~\cite{LehnSorger} \\\hline
operator of weight $w$ and degree $d$ & operator of weight $w$ and degree $d-2w$\\
$\q_m(a) $ & $\p_{-m}(a)$ \\
$ \mathfrak{L}_m(a) $ & $ - L_{-m}(a)$ \\
$\mathfrak{G}(a)$ & $a\hilb{\bullet}$\\
$ \mathfrak{d} $ & $ \partial $ \\
$\tau_{2*}(a)$& $-\Delta(a)$
\end{tabular}
\end{center}
\end{remark}

By sending a subscheme in $A$ to its support, we define a morphism
\begin{equation}\label{HilbertChow}
\rho : A\hilb{n} \longrightarrow \Sym^n(A),
\end{equation}
called the Hilbert--Chow morphism. The cohomology of $\Sym^n(A)$ is given by elements of the $n$-fold tensor power of $H^*(A)$ that are invariant under the action of the group of permutations $\mathfrak{S}_n$. A class in $H^*(A\hilb{n},\Q)$ which can be written using only the operators $\q_1(a)$ of weight $1$ comes from a pullback along $\rho$:
\begin{equation}
\label{qSym}
\q_1(b_1)\cdots \q_1(b_n)\vac = \rho^*\left( \sum_{\pi\in\mathfrak{S}_n } \pm b_{\pi(1)}\otimes\ldots\otimes b_{\pi(n)} \right), \quad b_i\in H^*(A,\Q),
\end{equation}
where signs arise from permuting factors of odd degrees. In particular,
\begin{gather} \label{q0primitive}
\frac{1}{n!}\q_1(b)^n \vac = \rho^*\big( b\otimes \ldots \otimes b\big),
\\ \label{q1primitive}
\frac{1}{(n-1)!}\q_1(b)\q^{n-1}\vac =\rho^*\Big( b\otimes\! 1\!\otimes\ldots\otimes\! 1\; + \;\ldots\; +\; 1\!\otimes\ldots\otimes\! 1\! \otimes b\Big) .
\end{gather}
\begin{remark}
With the notation from Section~\ref{SuperSection}, we have that
$$
H^*(\Sym^n(A),\Q) \cong \SSym^n(H^*(A,\Q)).
$$
Under this isomorphism the ring structure of $\SSym^n(H^*(A,\Q))$ corresponds to the cup product and the action of the operator $\q_1(a)$ corresponds to the operation $a\,\diamond$.
%Note that these description implies that the unit in $H^*(A\hilb{n},\Q)$ is given by
%$$
%1_{A\hilb{n}} = \frac{1}{n!} \q_1(1)^n\vac.
%$$
\end{remark}

%\begin{lemma}\label{maxPower}
%Assume $b\in H^2(A,\Q)$ and set $B_n\defIs \frac{1}{(n-1)!}\q_1(b)\q^{n-1}\vac =\G_0(b)1$. With the notion of double factorial $(2n-1)!! \defIs  \frac{(2n)!}{2^n n!}$ we have
%$$
%\left(B_n\right)^{2n} = (2n-1)!! \q_1(b^2)^n\vac.
%$$
%\end{lemma}
%\begin{proof}
%Multiplication with the class $\frac{1}{(n-1)!}\q_1(b)\q^{n-1}\vac$ is given by the operator $\G_0(b)$. Set $\alpha_{i,j} \defIs  \q^i\q_1(b)^j\q_1(b^2)^{n-i-j}\vac$. Then we have with Lemma~\ref{commutators}:
%\begin{equation}
%\G_0(b) \alpha_{i,j} = i\cdot\alpha_{i-1,j+1} + j\cdot \alpha_{i,j-1}.
%\end{equation}
%By an inductive argument one shows now that
%$$
%\G_0(b)^r \alpha_{n,0} = n! \sum_{\substack{i+j+k=n\\j+2k=r}}   Factor \cdot \alpha_{i,j}  
%$$
%Looking at (\ref{q0primitive}) and (\ref{q1primitive}), observe that 
%$$
%(B_n)^k = \rho^*\left(\sum_{i_1+\ldots+i_n= k}b^{i_1}\otimes\cdots\otimes b^{i_n}\right).
%$$
%Since the case $k=2n$ implies that all the $i_r$ are equal to $2$, the number of non-zero summands equals the number of partitions of a set of cardinality $2n$ into pairs. By~\cite[Prop.~2,4]{Kapfer}, this is $(2n-1)!!$.
%\end{proof}


\section{On integral cohomology of Hilbert schemes}\label{basisHilb2}

For the study of integral cohomology, first note that if $a \in H^*(A,\Z)$ is an integral class, then $\q_{m}(a) $ maps integral classes to integral classes. Such operators are called integral. Qin and Wang studied them in~\cite{QinWang}. We need the following results:

\begin{lemma} (\cite{QinWang}\label{IntegralOperators}, see also Thm.~\ref{QinWangTheorem}).
The operators $\frac{1}{n!}\q_1(1)^n$ and $\frac{1}{2}\q_2(1) $ are integral.
Let $b\in H^2(A,\Z)$ be monodromy equivalent to a divisor. Then the operator $\frac{1}{2}\q_1(b)^2 - \frac{1}{2}\q_2(b)$ is integral. 
\end{lemma}
\begin{remark}
Qin and Wang~\cite[Thm 1.1 et seq.]{QinWang} conjecture that their theory works even without the restriction on $b\in H^2(A,\Z)$. 
\end{remark}

\begin{corollary} \label{IntegralOperatorsTorus}
If $A$ is a torus, the operator $\frac{1}{2}\q_1(b)^2 - \frac{1}{2}\q_2(b)$ is integral for all $b\in H^2(A,\Z)$. 
\end{corollary}
\begin{proof}
The Nakajima operators are preserved under deformations of $A$. 
Moreover, by %\cite[Thm.~II]{Shioda},
\cite{Borcea}, 
the image of the monodromy representation on $H^2(A,\Z)$ is given by $O^{+,+}(H^2(A,\Z))$, the group of isometry on $H^2(A,\Z)$ which preserve the orientation of the negative and positive definite part of $H^2(A,\R)$.
%Since the lattice is even and contains two copies of the hyperbolic lattice, a theorem of Eichler~\cite[Prop.~3.7.3]{Scattone} states that the automorphism group of $H^2(A,\Z)$ acts transitively on classes of the same norm. 

%%The monodromy operators induce the entire automorphism group $SL(4,\Z)$ on $H^1(A,\Z)$.
%%Since $H^2(A,\Z)= \Lambda^2H^1(A,\Z)$, we see with a similar argument as in Remark~\ref{simplePlanes} that the monodromy operators act transitively on the simple tensors of $\Lambda^2H^1(A,\Z)$ with fixed norm.
%%Suppose that the N\'eron-Severi group $\NS(A)$ contains a basis element of $H^2(A,\Z)$ which can be written as a simple tensor (such $A$ exist).
%%Then, by action of monodromy operators, we see that the claim holds for all simple tensors.
%%An arbitrary element in $H^2(A,\Z)$ is linear combination of simple tensors. Since the integrality of our operator is preserved under linear combinations, the corollary is proved for that particular torus $A$.

Suppose now that the N\'eron-Severi group $\NS(A)$ contains a copy of the hyperbolic lattice $U$ (such $A$ exist).
%Since $U\subset \NS(A)$, there are divisors of arbitrary even norm,
%so every class can be mapped to a divisor by the action of a monodromy 
Let us denote $H^2(A,\Z)=U_1\oplus U_2\oplus U_3$ with $\NS(A)=U_1$.
We consider two isometries in $O^{+,+}(H^2(A,\Z))$, $\varphi_2$ and $\varphi_3$, defined in the following way:
$\varphi_2$ exchanges $U_1$ and $U_2$ and acts as $-\id$ on $U_3$ and $\varphi_3$ exchanges $U_1$ and $U_3$ and acts as $-\id$ on $U_2$.
Using these two isometries, all elements of $U_2$ and $U_3$ are monodromy equivalent to a divisor.
Then Lemma~\ref{IntegralOperators} establishes the corollary for that particular $A$. 
Now, since all tori are equivalent by deformation, a general torus can always be deformed to our special $A$. Since the integrality of an operator is a topological invariant, $\frac{1}{2}\q_1(b)^2 - \frac{1}{2}\q_2(b)$ remains integral for all $b\in H^2(A,\Z)$.
\end{proof}

\begin{proposition} Assume that $H^*(A,\Z)$ is free of torsion.
Let $(a_i) \subset H^1(A,\Z)$ and $(b_i)\subset H^2(A,\Z)$ be bases of integral cohomology as in Notation~\ref{TorusClasses}. Denote $a_i^*\in H^3(A,\Z)$ resp.~$b_i^*\in H^2(A,\Z)$ the elements of the dual bases. Let $x$ be the generator of $H^4(A,\Z)$. Modulo torsion, the following classes form a basis of $H^2(A\hilb{n},\Z)$:
\begin{itemize}
 \item $\frac{1}{(n-1)!}\q_{1}(b_{i})\q_{1}(1)^{n-1}\vac = \G_0(b_i) 1$,
 \item $ \frac{1}{(n-2)!}\q_{1}(a_{i})\q_{1}(a_{j})\q_{1}(1)^{n-2}\vac = \G_0(a_i) \G_0(a_j)1,\  i < j$, 
 \item $ \frac{1}{2(n-2)!}\q_{2}(1) \q_{1}(1)^{n-2}\vac$. We denote this class by $\delta = \d 1$.
\end{itemize}
Their respective duals in $H^{2n-2}(A\hilb{n},\Z)$ are given by
\begin{itemize}
 \item $\q_{1}(b_{i}^*)\q_{1}(x)^{n-1}\vac$,
 \item $\q_{1}(a_{j}^*)\q_{1}(a_{i}^*)\q_{1}(x)^{n-2}\vac,\  i < j$,
 \item $\q_2(x)\q_{1}(x)^{n-2} \vac$.
\end{itemize}
\end{proposition}
\begin{proof} It is clear from the above lemma that these classes are all integral.
G\"ottsche's formula~\cite[p.~35]{Gottsche} gives the Betti numbers of $A\hilb{n}$ in terms of the Betti numbers of $A$: 
$h^1(A\hilb{n}) = h^1(A)$, and $h^2(A\hilb{n}) = h^2(A)+ \frac{h^1(A)(h^1(A)-1)}{2} + 1$. It follows that the given classes span a lattice of full rank.

Next we have to show that the intersection matrix between these classes is in fact the identity matrix. Most of the entries can be computed easily using the simplification from (\ref{qSym}). For products involving $\delta$ (this is the action of $\mathfrak{d}$) or its dual, first observe that $\mathfrak{d}\q_1(x)^m\vac = 0 $ and $ \mathfrak{L}_1(a)\q_1(x)^m\vac =0$ for every class $a$ of degree at least 1. Then compute:
\begin{gather*}
\delta \cdot\q_2(x)\q_{1}(x)^{n-2} \vac = \mathfrak{d}\q_2(x)\q_{1}(x)^{n-2} \vac = 2 \mathfrak{L}_2(x) \q_{1}(x)^{n-2} \vac = \q_{1}(x)^{n}\vac,
\\
\mathfrak{d}\q_{1}(b_{i}^*)\q_{1}(x)^{n-1}\vac =  \mathfrak{L}_1(b_i^*) \q_{1}(x)^{n-1} \vac = 0,
\\
\mathfrak{d}\q_{1}(a_{j}^*)\q_{1}(a_{i}^*)\q_{1}(x)^{n-2}\vac = \left(\mathfrak{L}_1(a_j^*) +\q_{1}(a_{j}^*)\mathfrak{d}\right)\q_{1}(a_{i}^*)\q_{1}(x)^{n-2}\vac = 
  \\ =\left(-\q_1(a_i^*)\mathfrak{L}_1(a_j^*) + \q_{1}(a_{j}^*)\mathfrak{L}_1(a_i^*)\right)\q_{1}(x)^{n-2}\vac  = 0,
\\
\G_0(b_i)\q_2(x)\q_{1}(x)^{n-2} \vac = 0, 
\\
\G_0(a_i)\G_0(a_j)\q_2(x)\q_{1}(x)^{n-2} \vac = 0.
\qedhere
\end{gather*}
\end{proof}

\begin{remark}
If $A$ is a complex torus, a theorem of Markman~\cite{Markman} ensures that $H^*(A\hilb{n},\Z)$ is free of torsion.
\end{remark} 

\begin{proposition} \label{A2Basis}
Let $A$ be a complex abelian surface. Using Notation~\ref{TorusClasses}, a basis of $H^*(A\hilb{2},\Z)$ is given by the following classes.
\begin{center}
\begin{tabular}{c|c|l|l}
 degree & Betti number & class & multiplication with class \\\hline
 0 & 1 & $\frac{1}{2}\q_1(1)^2\vac$ & $\id$ \\ \hline
 1 & 4 &  $\q_1(1)\q_1(a_i)\vac$ & $\G_0(a_i)$ \\ \hline
 2 & 13 & $\frac{1}{2}\q_2(1)\vac$ & $\d$ \\ 
   &  & $\q_1(a_i)\q_1(a_j)\vac$ for $i<j$ & $\G_0(a_i)\G_0(a_j)$ \\
   &  & $\q_1(1)\q_1(b_i)\vac$ & $\G_0(b_i)$ \\\hline
 3 & 32 & $\q_2(a_i)\vac$  & $-2\G_1(a_i) $ \\
   &  & $\q_1(a_i)\q_1(b_j)\vac$ & $\G_0(a_i)\G_0(b_j)$ \\ 
   &  & $\q_1(1)\q_1(a^*_i)\vac$ & $\G_0(a^*_i)$ \\\hline
 4 & 44 & $\left(\frac{1}{2}\q_1(b_i)^2-\frac{1}{2}\q_2(b_i)\right)\vac$ & $\frac{1}{2} \G_0(b_i)^2 + \G_1(b_i) $ \\
   &  & $\q_1(a_i)\q_1(a^*_j)\vac$ & $\G_0(a_i)\G_0(a^*_j)$ \\
   &  & $ \q_1(b_i)\q_1(b_j)\vac$ for $i\leq j$ &  $\G_0(b_i)\G_0(b_j)$ \\\hline
 5 & 32 & $\frac{1}{2}\q_2(a^*_i)\vac$ & $-\G_1(a^*_i)$ \\
   &  & $\q_1(a^*_i)\q_1(b_j)\vac$ & $ \G_0(a^*_i)\G_0(b_j)$ \\
   &  & $\q_1(a_i)\q_1(x)\vac$ & $\G_0(a_i)\G_0(x)$ \\\hline
 6 & 13 & $\q_2(x)\vac$ & $-2\G_1(x)$ \\
   &  & $\q_1(a^*_i)\q_1(a^*_j)\vac$ for $i<j$ & $\G_0(a^*_i)\G_0(a^*_j)$ \\
   &  & $\q_1(b_i)\q_1(x)\vac$ & $ \G_0(b_i)\G_0(x)$ \\\hline
 7 & 4 & $\q_1(a^*_i)\q_1(x)\vac$ & $\G_0(a^*_i)\G_0(x) $ \\\hline
 8 & 1 & $\q_1(x)^2\vac$ & $\G_0(x)^2$ 
\end{tabular}
\end{center}
\begin{proof}
The Betti numbers come from G\"ottsche's formula~\cite{Gottsche}.
One computes the intersection matrix of all classes under the Poincar\'e duality pairing and finds that it is unimodular. 
So it remains to show that all these classes are integral. By Lemma~\ref{IntegralOperators} this is clear for all classes except 
those of the form $\frac{1}{2}\q_2(a^*_i)\vac \in H^5(A\hilb{2},\Z)$.

Evaluating the Poincar\'e duality pairing between degrees 3 and 5 gives:
\begin{gather*}
 \q_2(a_i)\vac \cdot \q_2(a^*_i)\vac = 2, \\
 \q_1(a_i)\q_1(b_j)\vac \cdot  \q_1(a^*_i)\q_1(b^*_j)\vac = 1, \\
 \q_1(1)\q_1(a^*_i)\vac \cdot \q_1(x)\q_1(a_i)\vac = 1,
\end{gather*}
while the other pairings vanish. Therefore, one of $\q_2(a_i)\vac$ and $\q_2(a^*_i)\vac$ must be divisible by $2$. 
With the considerations from Section~\ref{OddHilb2} in mind, we can interpret $\q_2(a_i)\vac\in H^3(A\hilb{2},\Z)$ and $\q_2(a^*_i)\vac\in H^5(A\hilb{2},\Z)$ as classes concentrated on the exceptional divisor, that is, as elements of $\pi_* j_*H^*(E,\Z)$. Indeed,
the pushforward of a class $a\otimes 1 \in H^{k}(E,\Z)$ is given by 
$$
\pi_* j_*(a\otimes 1) = \q_2(a)\vac \in H^{k+2}(A\hilb{n},\Z).
$$
When pushing forward to the Hilbert scheme, the only possibility to get a factor $2$ is in degree $5$, by Proposition~\ref{Alpha35}. 
\end{proof}

\end{proposition}
